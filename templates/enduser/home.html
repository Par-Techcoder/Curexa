{% extends "enduser/base.html" %}
{% block title %}Curexa - Online Pharmacy & Doctor Consultation{% endblock %}
{% load static %}
{% block content %}

    <!-- Hero Section with Search -->
    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-4 fw-bold mb-4">Your Health, Our Priority</h1>
            <p class="lead mb-5">Get medicines delivered & consult doctors online</p>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control form-control-lg" placeholder="Search medicines or healthcare products...">
                        <button class="btn btn-primary" type="button">Search</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Shop by Category</h2>
            <div class="row">
                <div class="col-md-3 mb-4">
                    <div class="card category-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Medicines" class="card-img-top" alt="Medicines">
                        <div class="card-body text-center">
                            <h5 class="card-title">Medicines</h5>
                            <a href="#" class="btn btn-sm btn-outline-primary">Shop Now</a>
                        </div>
                    </div>
                </div>
                <!-- Repeat for other categories -->
                <div class="col-md-3 mb-4">
                    <div class="card category-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Wellness" class="card-img-top" alt="Wellness">
                        <div class="card-body text-center">
                            <h5 class="card-title">Wellness</h5>
                            <a href="#" class="btn btn-sm btn-outline-primary">Shop Now</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card category-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Personal+Care" class="card-img-top" alt="Personal Care">
                        <div class="card-body text-center">
                            <h5 class="card-title">Personal Care</h5>
                            <a href="#" class="btn btn-sm btn-outline-primary">Shop Now</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card category-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Health+Devices" class="card-img-top" alt="Health Devices">
                        <div class="card-body text-center">
                            <h5 class="card-title">Health Devices</h5>
                            <a href="#" class="btn btn-sm btn-outline-primary">Shop Now</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container my-5">
    <h3 class="mb-4 fw-bold">Browse by Health Conditions</h3>
    <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-3">
        
        <!-- Card Item -->
        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/diabetes.png' %}" alt="Diabetes Care" class="mb-2" height="40">
            <div>Diabetes Care</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/cardiac.png' %}" alt="Cardiac Care" class="mb-2" height="40">
            <div>Cardiac Care</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/stomach.png' %}" alt="Stomach Care" class="mb-2" height="40">
            <div>Stomach Care</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/pain.png' %}" alt="Pain Relief" class="mb-2" height="40">
            <div>Pain Relief</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/liver.png' %}" alt="Liver Care" class="mb-2" height="40">
            <div>Liver Care</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/oral.png' %}" alt="Oral Care" class="mb-2" height="40">
            <div>Oral Care</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/respiratory.png' %}" alt="Respiratory" class="mb-2" height="40">
            <div>Respiratory</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/sexual.png' %}" alt="Sexual Health" class="mb-2" height="40">
            <div>Sexual Health</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/elderly.png' %}" alt="Elderly Care" class="mb-2" height="40">
            <div>Elderly Care</div>
        </div>
        </div>

        <div class="col">
        <div class="border rounded p-3 text-center">
            <img src="{% static 'images/icons/cold.png' %}" alt="Cold & Immunity" class="mb-2" height="40">
            <div>Cold & Immunity</div>
        </div>
        </div>

    </div>
    </section>

    <!-- Doctor Consultation Section -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">Consult Top Doctors Online</h2>
            <div class="row">
                <div class="col-md-3 mb-4">
                    <div class="card doctor-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Doctor+1" class="card-img-top" alt="Doctor">
                        <div class="card-body">
                            <h5 class="card-title">Dr. Ramesh Kumar</h5>
                            <p class="text-muted">Cardiologist</p>
                            <p class="card-text"><i class="fas fa-star text-warning"></i> 4.8 (120 reviews)</p>
                            <a href="#" class="btn btn-primary w-100">Book Appointment</a>
                        </div>
                    </div>
                </div>
                <!-- Repeat for other doctors -->
                <div class="col-md-3 mb-4">
                    <div class="card doctor-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Doctor+2" class="card-img-top" alt="Doctor">
                        <div class="card-body">
                            <h5 class="card-title">Dr. Priya Sharma</h5>
                            <p class="text-muted">Dermatologist</p>
                            <p class="card-text"><i class="fas fa-star text-warning"></i> 4.9 (95 reviews)</p>
                            <a href="#" class="btn btn-primary w-100">Book Appointment</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card doctor-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Doctor+3" class="card-img-top" alt="Doctor">
                        <div class="card-body">
                            <h5 class="card-title">Dr. Amit Patel</h5>
                            <p class="text-muted">Pediatrician</p>
                            <p class="card-text"><i class="fas fa-star text-warning"></i> 4.7 (150 reviews)</p>
                            <a href="#" class="btn btn-primary w-100">Book Appointment</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card doctor-card h-100">
                        <img src="https://via.placeholder.com/300x200?text=Doctor+4" class="card-img-top" alt="Doctor">
                        <div class="card-body">
                            <h5 class="card-title">Dr. Neha Gupta</h5>
                            <p class="text-muted">Gynecologist</p>
                            <p class="card-text"><i class="fas fa-star text-warning"></i> 4.8 (110 reviews)</p>
                            <a href="#" class="btn btn-primary w-100">Book Appointment</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <a href="#" class="btn btn-outline-primary">View All Doctors</a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-5">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-3 mb-4">
                    <div class="p-4">
                        <i class="fas fa-truck fa-3x text-primary mb-3"></i>
                        <h4>Free Delivery</h4>
                        <p class="text-muted">On orders above ₹500</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="p-4">
                        <i class="fas fa-prescription fa-3x text-primary mb-3"></i>
                        <h4>Upload Prescription</h4>
                        <p class="text-muted">Easy prescription upload</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="p-4">
                        <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                        <h4>100% Safe</h4>
                        <p class="text-muted">Authentic medicines</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="p-4">
                        <i class="fas fa-headset fa-3x text-primary mb-3"></i>
                        <h4>24/7 Support</h4>
                        <p class="text-muted">Dedicated customer care</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
   
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
        
        <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">Login / Register</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <div class="modal-body">
            
            <!-- Step 1: Contact Input -->
            <form id="contactForm">
            <div class="mb-3">
                <label for="contactInput" class="form-label">Enter Email</label>
                <input type="text" class="form-control" id="contactInput" placeholder="Enter email" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Continue</button>
            </form>
            
            <!-- Step 2: OTP Input -->
            <form id="otpForm" style="display: none;">
            <div class="mb-3">
                <label for="otpInput" class="form-label">Enter OTP</label>
                <input type="text" class="form-control" id="otpInput" placeholder="Enter OTP" required>
            </div>
            <button type="submit" class="btn btn-success w-100">Verify OTP</button>
            <p class="text-muted mt-2 small">OTP sent to <span id="contactDisplay"></span></p>
            </form>

        </div>
        
        </div>
    </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


<script>
document.addEventListener('DOMContentLoaded', function () {
    const loginBtn = document.getElementById('loginBtn');
    const loginModalEl = document.getElementById('loginModal');
    const loginModal = new bootstrap.Modal(loginModalEl);

    const contactForm = document.getElementById('contactForm');
    const otpForm = document.getElementById('otpForm');
    const contactDisplay = document.getElementById('contactDisplay');
    
    // Step 1 → Send OTP via AJAX
    contactForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const contactValue = document.getElementById('contactInput').value.trim();

        if (!contactValue) return;

        fetch("/send-otp/", {
            method: "POST",
            headers: {
                "X-CSRFToken": getCookie("csrftoken"),  // keep if CSRF protection
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `contact=${encodeURIComponent(contactValue)}`
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                contactForm.style.display = "none";
                otpForm.style.display = "block";
                contactDisplay.textContent = contactValue;
            } else {
                alert(data.message);
            }
        });
    });

    // Step 2 → Verify OTP
    otpForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const otpValue = document.getElementById('otpInput').value.trim();
        const contactValue = contactDisplay.textContent;

        fetch("/verify-otp/", {
            method: "POST",
            headers: {
                "X-CSRFToken": getCookie("csrftoken"), // keep if CSRF protection
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `contact=${encodeURIComponent(contactValue)}&otp=${encodeURIComponent(otpValue)}`
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                loginModal.hide();
                // Redirect to login
                window.location.href = '/';
            } else {
                alert(data.message);
            }
        });
    });

    // Open modal & change URL when login is clicked
    loginBtn.addEventListener('click', function () {
        const newUrl = window.location.pathname + '?popup_state=open_login_popup&continue=/';
        window.history.pushState({ path: newUrl }, '', newUrl);
        loginModal.show();
    });

    // Remove query when modal closes
    loginModalEl.addEventListener('hidden.bs.modal', function () {
        window.history.pushState({}, '', window.location.pathname);
        contactForm.style.display = "block";
        otpForm.style.display = "none";
    });

    // Auto-open if URL has ?popup_state=open_login_popup
    const params = new URLSearchParams(window.location.search);
    if (params.get('popup_state') === 'open_login_popup') {
        loginModal.show();
    }
});

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

</script>

{% endblock content %}