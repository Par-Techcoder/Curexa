<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Curexa Admin — Products</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config for a futuristic vibe
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8',
              500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81'
            },
            accent: {
              500: '#22d3ee', 600: '#06b6d4', 700: '#0891b2'
            }
          },
          boxShadow: {
            glow: '0 0 15px rgba(99,102,241,0.4)',
            soft: '0 6px 30px rgba(0,0,0,0.25)'
          },
          backdropBlur: {
            xs: '2px'
          }
        }
      }
    }
  </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; }
    /* Glass morphism helpers */
    .glass { background: linear-gradient(135deg, rgba(20,22,36,0.65), rgba(12,14,27,0.5)); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.06); }
    .glass-soft { background: linear-gradient(135deg, rgba(22,24,40,0.55), rgba(9,11,24,0.45)); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.06); }
    .gradient-bg { background: radial-gradient(1200px 600px at -10% -10%, rgba(99,102,241,0.3), transparent 60%), radial-gradient(1000px 500px at 110% 0%, rgba(34,211,238,0.25), transparent 60%), linear-gradient(180deg, #0b1020 0%, #090e1a 60%, #070b14 100%); }
    .card-hover { transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.05) inset; border-color: rgba(255,255,255,.08); }
    .focus-ring { outline: 2px solid transparent; outline-offset: 2px; box-shadow: 0 0 0 3px rgba(99,102,241,.45); }
  </style>
</head>

<body class="gradient-bg text-slate-200">
  <!-- Page Shell -->
  <div class="min-h-screen relative">
    <!-- Top Nav -->
    <header class="sticky top-0 z-40 border-b border-white/10 glass">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="h-9 w-9 rounded-2xl bg-primary-600/40 ring-1 ring-white/10 grid place-items-center shadow-glow">
              <i data-lucide="pill" class="h-5 w-5"></i>
            </div>
            <div>
              <h1 class="text-lg font-bold tracking-tight">Curexa <span class="font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-primary-400 to-accent-500">Admin</span></h1>
              <p class="text-xs text-slate-400 -mt-0.5">Products • Inventory • Pricing</p>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <button id="themeToggle" class="inline-flex items-center gap-2 rounded-xl border border-white/10 px-3 py-2 text-sm glass-soft hover:border-white/20" title="Toggle density">
              <i data-lucide="layout-grid" class="h-4 w-4"></i>
              Dense
            </button>
            <button class="inline-flex items-center gap-2 rounded-xl border border-white/10 px-3 py-2 text-sm glass-soft hover:border-white/20" title="Settings">
              <i data-lucide="settings" class="h-4 w-4"></i>
              Settings
            </button>
            <div class="h-8 w-px bg-white/10 mx-1"></div>
            <div class="flex items-center gap-3">
              <span class="text-xs text-slate-400">Admin</span>
              <img src="https://i.pravatar.cc/40?img=68" alt="Admin Avatar" class="h-9 w-9 rounded-xl ring-1 ring-white/10" />
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Toolbar -->
    <section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-5">
      <div class="grid gap-3 md:grid-cols-12">
        <div class="md:col-span-4">
          <label for="search" class="sr-only">Search products</label>
          <div class="flex items-center gap-2 rounded-2xl glass-soft border border-white/10 px-3 py-2">
            <i data-lucide="search" class="h-5 w-5 text-slate-400"></i>
            <input id="search" type="text" placeholder="Search by name, SKU or brand…" class="w-full bg-transparent placeholder:text-slate-500 focus:outline-none" />
          </div>
        </div>
        <div class="md:col-span-3">
          <div class="rounded-2xl glass-soft border border-white/10 px-3 py-2 flex items-center gap-2">
            <i data-lucide="filter" class="h-5 w-5 text-slate-400"></i>
            <select id="filterCategory" class="w-full bg-transparent focus:outline-none">
              <option value="all">All categories</option>
              <option value="medicine">Medicine</option>
              <option value="supplement">Supplements</option>
              <option value="equipment">Equipment</option>
              <option value="personal-care">Personal Care</option>
            </select>
          </div>
        </div>
        <div class="md:col-span-3">
          <div class="rounded-2xl glass-soft border border-white/10 px-3 py-2 flex items-center gap-2">
            <i data-lucide="arrow-up-down" class="h-5 w-5 text-slate-400"></i>
            <select id="sortBy" class="w-full bg-transparent focus:outline-none">
              <option value="name-asc">Name (A→Z)</option>
              <option value="name-desc">Name (Z→A)</option>
              <option value="price-asc">Price (Low→High)</option>
              <option value="price-desc">Price (High→Low)</option>
              <option value="stock-desc">Stock (High→Low)</option>
            </select>
          </div>
        </div>
        <div class="md:col-span-2 flex items-stretch gap-2">
          <button id="exportCsv" class="flex-1 rounded-2xl border border-white/10 px-3 py-2 text-sm glass-soft hover:border-white/20">
            <i data-lucide="download" class="inline h-4 w-4 mr-1"></i> Export CSV
          </button>
          <button id="bulkActions" class="rounded-2xl border border-white/10 px-3 py-2 text-sm glass-soft hover:border-white/20">
            <i data-lucide="more-horizontal" class="inline h-4 w-4"></i>
          </button>
        </div>
      </div>
    </section>

    <!-- Stats -->
    <section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-2">
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <div class="glass rounded-2xl p-4 border border-white/10 card-hover">
          <div class="flex items-center justify-between">
            <p class="text-sm text-slate-400">Total Products</p>
            <i data-lucide="boxes" class="h-5 w-5"></i>
          </div>
          <p id="statTotal" class="mt-2 text-2xl font-extrabold">0</p>
        </div>
        <div class="glass rounded-2xl p-4 border border-white/10 card-hover">
          <div class="flex items-center justify-between">
            <p class="text-sm text-slate-400">Low Stock (&lt; 10)</p>
            <i data-lucide="alert-triangle" class="h-5 w-5"></i>
          </div>
          <p id="statLow" class="mt-2 text-2xl font-extrabold">0</p>
        </div>
        <div class="glass rounded-2xl p-4 border border-white/10 card-hover">
          <div class="flex items-center justify-between">
            <p class="text-sm text-slate-400">Active</p>
            <i data-lucide="check-circle-2" class="h-5 w-5"></i>
          </div>
          <p id="statActive" class="mt-2 text-2xl font-extrabold">0</p>
        </div>
        <div class="glass rounded-2xl p-4 border border-white/10 card-hover">
          <div class="flex items-center justify-between">
            <p class="text-sm text-slate-400">Disabled</p>
            <i data-lucide="x-circle" class="h-5 w-5"></i>
          </div>
          <p id="statDisabled" class="mt-2 text-2xl font-extrabold">0</p>
        </div>
      </div>
    </section>

    <!-- Product Grid -->
    <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
      <div id="productGrid" class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>

      <!-- Pagination -->
      <div class="mt-8 flex items-center justify-between">
        <p id="pageInfo" class="text-sm text-slate-400">Page 1</p>
        <div class="flex gap-2">
          <button id="prevPage" class="rounded-xl border border-white/10 px-3 py-2 glass-soft disabled:opacity-40">Prev</button>
          <button id="nextPage" class="rounded-xl border border-white/10 px-3 py-2 glass-soft disabled:opacity-40">Next</button>
        </div>
      </div>
    </main>

    <!-- Floating Add Button -->
    <button id="addProductBtn" class="fixed bottom-6 right-6 group rounded-2xl bg-gradient-to-r from-primary-600 to-accent-600 shadow-glow hover:shadow-soft px-5 py-4 flex items-center gap-2">
      <i data-lucide="plus" class="h-5 w-5"></i>
      <span class="font-semibold">Add Product</span>
    </button>

    <!-- Add/Edit Modal -->
    <div id="productModal" class="hidden fixed inset-0 z-50 grid place-items-center p-4">
      <div class="absolute inset-0 bg-black/60"></div>
      <div class="relative w-full max-w-2xl rounded-2xl glass border border-white/10 p-6">
        <div class="flex items-start justify-between">
          <div>
            <h3 id="modalTitle" class="text-xl font-bold">Add product</h3>
            <p class="text-sm text-slate-400">Create or update a catalog item.</p>
          </div>
          <button id="closeModal" class="rounded-xl border border-white/10 p-2 glass-soft" title="Close">
            <i data-lucide="x" class="h-4 w-4"></i>
          </button>
        </div>

        <form id="productForm" class="mt-5 grid gap-4 sm:grid-cols-2">
          <input type="hidden" id="productId" />

          <div class="sm:col-span-1">
            <label class="text-sm text-slate-400">Name</label>
            <input id="name" required class="mt-1 w-full rounded-xl border border-white/10 bg-black/20 p-3 focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="Paracetamol 650mg" />
          </div>

          <div class="sm:col-span-1">
            <label class="text-sm text-slate-400">SKU</label>
            <input id="sku" required class="mt-1 w-full rounded-xl border border-white/10 bg-black/20 p-3 focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="MED-0001" />
          </div>

          <div class="sm:col-span-1">
            <label class="text-sm text-slate-400">Category</label>
            <select id="category" class="mt-1 w-full rounded-xl border border-white/10 bg-black/20 p-3 focus:outline-none focus:ring-2 focus:ring-primary-600">
              <option value="medicine">Medicine</option>
              <option value="supplement">Supplement</option>
              <option value="equipment">Equipment</option>
              <option value="personal-care">Personal Care</option>
            </select>
          </div>

          <div class="sm:col-span-1">
            <label class="text-sm text-slate-400">Price (₹)</label>
            <input id="price" type="number" step="0.01" min="0" required class="mt-1 w-full rounded-xl border border-white/10 bg-black/20 p-3 focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="99.00" />
          </div>

          <div class="sm:col-span-1">
            <label class="text-sm text-slate-400">Stock</label>
            <input id="stock" type="number" min="0" required class="mt-1 w-full rounded-xl border border-white/10 bg-black/20 p-3 focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="150" />
          </div>

          <div class="sm:col-span-1">
            <label class="text-sm text-slate-400">Image URL</label>
            <input id="image" type="url" class="mt-1 w-full rounded-xl border border-white/10 bg-black/20 p-3 focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="https://images.example.com/product.jpg" />
          </div>

          <div class="sm:col-span-2">
            <label class="text-sm text-slate-400">Description</label>
            <textarea id="description" rows="3" class="mt-1 w-full rounded-xl border border-white/10 bg-black/20 p-3 focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="Brief details for your product."></textarea>
          </div>

          <div class="sm:col-span-2 flex items-center justify-between pt-2">
            <div class="flex items-center gap-2">
              <input id="active" type="checkbox" class="rounded border-white/20 bg-black/30" checked />
              <label for="active" class="text-sm">Active</label>
            </div>
            <div class="flex gap-2">
              <button type="button" id="resetForm" class="rounded-xl border border-white/10 px-4 py-2 glass-soft">Reset</button>
              <button type="submit" class="rounded-xl bg-gradient-to-r from-primary-600 to-accent-600 px-5 py-2 font-semibold shadow-glow">Save</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Templates -->
  <template id="productCardTemplate">
    <article class="glass rounded-2xl border border-white/10 p-3 card-hover flex flex-col">
      <div class="relative">
        <img class="h-40 w-full rounded-xl object-cover" alt="Product image" />
        <span class="absolute left-2 top-2 rounded-lg bg-black/50 px-2 py-1 text-xs" data-slot="sku"></span>
        <span class="absolute right-2 top-2 rounded-lg px-2 py-1 text-xs" data-slot="badge"></span>
      </div>
      <div class="mt-3 flex-1">
        <h3 class="text-base font-semibold" data-slot="name"></h3>
        <p class="text-sm text-slate-400" data-slot="category"></p>
        <p class="mt-1 text-xl font-extrabold" data-slot="price"></p>
      </div>
      <div class="mt-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <button class="rounded-lg border border-white/10 px-2 py-1 text-xs glass-soft" data-action="edit"><i data-lucide="pencil" class="h-3.5 w-3.5"></i> Edit</button>
          <button class="rounded-lg border border-white/10 px-2 py-1 text-xs glass-soft" data-action="duplicate"><i data-lucide="copy" class="h-3.5 w-3.5"></i> Copy</button>
        </div>
        <div class="flex items-center gap-2">
          <label class="text-xs text-slate-400">Active</label>
          <input type="checkbox" class="toggle-active rounded border-white/20 bg-black/30" />
          <button class="rounded-lg border border-white/10 p-1 glass-soft" data-action="delete" title="Delete"><i data-lucide="trash-2" class="h-4 w-4"></i></button>
        </div>
      </div>
    </article>
  </template>

  <!-- Demo Data + JS -->
  <script>
    const state = {
      dense: false,
      page: 1,
      perPage: 8,
      products: [
        { id: crypto.randomUUID(), name: 'Paracetamol 650mg', sku: 'MED-0001', category: 'medicine', price: 29.0, stock: 120, active: true, image: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&w=1200&auto=format&fit=crop', description: 'Analgesic and antipyretic.' },
        { id: crypto.randomUUID(), name: 'Digital Thermometer', sku: 'EQP-0043', category: 'equipment', price: 299.0, stock: 8, active: true, image: 'https://images.unsplash.com/photo-1582719508461-905c673771fd?q=80&w=1200&auto=format&fit=crop', description: 'Fast and accurate readings.' },
        { id: crypto.randomUUID(), name: 'Vitamin C 1000mg', sku: 'SUP-0102', category: 'supplement', price: 249.0, stock: 64, active: true, image: 'https://images.unsplash.com/photo-1616410011236-7db1d1b4b2c2?q=80&w=1200&auto=format&fit=crop', description: 'Immune support tablets.' },
        { id: crypto.randomUUID(), name: 'Hand Sanitizer 500ml', sku: 'PC-0200', category: 'personal-care', price: 149.0, stock: 0, active: false, image: 'https://images.unsplash.com/photo-1584630176563-073cc05f9030?q=80&w=1200&auto=format&fit=crop', description: 'Kills 99.9% germs.' },
        { id: crypto.randomUUID(), name: 'Blood Pressure Monitor', sku: 'EQP-1001', category: 'equipment', price: 1899.0, stock: 23, active: true, image: 'https://images.unsplash.com/photo-1576765608731-47e02b3b2c7a?q=80&w=1200&auto=format&fit=crop', description: 'Automatic BP monitor.' },
        { id: crypto.randomUUID(), name: 'Zinc Tablets 50mg', sku: 'SUP-0330', category: 'supplement', price: 199.0, stock: 15, active: true, image: 'https://images.unsplash.com/photo-1607619056574-7b8d3ee536b2?q=80&w=1200&auto=format&fit=crop', description: 'Dietary supplement.' },
        { id: crypto.randomUUID(), name: 'Cough Syrup 100ml', sku: 'MED-0209', category: 'medicine', price: 110.0, stock: 7, active: true, image: 'https://images.unsplash.com/photo-1597074866922-020f77a7a062?q=80&w=1200&auto=format&fit=crop', description: 'Soothing relief.' },
        { id: crypto.randomUUID(), name: 'Infrared Thermometer', sku: 'EQP-0044', category: 'equipment', price: 1499.0, stock: 3, active: false, image: 'https://images.unsplash.com/photo-1581089781785-603411fa81e5?q=80&w=1200&auto=format&fit=crop', description: 'Contactless temperature.' },
        { id: crypto.randomUUID(), name: 'Multivitamin Capsules', sku: 'SUP-0103', category: 'supplement', price: 399.0, stock: 75, active: true, image: 'https://images.unsplash.com/photo-1582719478250-71b68c7cb1bf?q=80&w=1200&auto=format&fit=crop', description: 'Daily multivitamin.' },
        { id: crypto.randomUUID(), name: 'Antiseptic Liquid 1L', sku: 'PC-0201', category: 'personal-care', price: 220.0, stock: 11, active: true, image: 'https://images.unsplash.com/photo-1604152135912-04a022e23696?q=80&w=1200&auto=format&fit=crop', description: 'For first aid & hygiene.' }
      ]
    };

    const els = {
      grid: document.getElementById('productGrid'),
      search: document.getElementById('search'),
      filter: document.getElementById('filterCategory'),
      sort: document.getElementById('sortBy'),
      addBtn: document.getElementById('addProductBtn'),
      modal: document.getElementById('productModal'),
      closeModal: document.getElementById('closeModal'),
      form: document.getElementById('productForm'),
      resetForm: document.getElementById('resetForm'),
      productId: document.getElementById('productId'),
      name: document.getElementById('name'),
      sku: document.getElementById('sku'),
      category: document.getElementById('category'),
      price: document.getElementById('price'),
      stock: document.getElementById('stock'),
      image: document.getElementById('image'),
      description: document.getElementById('description'),
      active: document.getElementById('active'),
      modalTitle: document.getElementById('modalTitle'),
      prev: document.getElementById('prevPage'),
      next: document.getElementById('nextPage'),
      pageInfo: document.getElementById('pageInfo'),
      statTotal: document.getElementById('statTotal'),
      statLow: document.getElementById('statLow'),
      statActive: document.getElementById('statActive'),
      statDisabled: document.getElementById('statDisabled'),
      exportCsv: document.getElementById('exportCsv'),
      themeToggle: document.getElementById('themeToggle')
    };

    const TPL = document.getElementById('productCardTemplate');

    // Helpers
    const currency = (n) => `₹${Number(n).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    const byQuery = (q) => (p) => [p.name, p.sku, p.category].join(' ').toLowerCase().includes(q);

    function computeStats(list) {
      els.statTotal.textContent = list.length;
      els.statLow.textContent = list.filter(p => p.stock < 10).length;
      els.statActive.textContent = list.filter(p => p.active).length;
      els.statDisabled.textContent = list.filter(p => !p.active).length;
    }

    function getFilteredSorted() {
      let list = [...state.products];
      const q = els.search.value.trim().toLowerCase();
      if (q) list = list.filter(byQuery(q));
      const cat = els.filter.value;
      if (cat !== 'all') list = list.filter(p => p.category === cat);
      switch (els.sort.value) {
        case 'name-asc': list.sort((a,b)=>a.name.localeCompare(b.name)); break;
        case 'name-desc': list.sort((a,b)=>b.name.localeCompare(a.name)); break;
        case 'price-asc': list.sort((a,b)=>a.price-b.price); break;
        case 'price-desc': list.sort((a,b)=>b.price-a.price); break;
        case 'stock-desc': list.sort((a,b)=>b.stock-a.stock); break;
      }
      return list;
    }

    function paginate(list) {
      const start = (state.page - 1) * state.perPage;
      const end = start + state.perPage;
      const totalPages = Math.max(1, Math.ceil(list.length / state.perPage));
      state.page = Math.min(state.page, totalPages);
      const slice = list.slice(start, end);
      els.pageInfo.textContent = `Page ${state.page} of ${totalPages}`;
      els.prev.disabled = state.page === 1;
      els.next.disabled = state.page === totalPages;
      return slice;
    }

    function badge(el, product) {
      const span = el.querySelector('[data-slot="badge"]');
      const base = 'rounded-lg px-2 py-1 text-xs';
      if (product.stock === 0) {
        span.textContent = 'Out of stock';
        span.className = base + ' bg-red-500/20 text-red-300 border border-red-400/20 backdrop-blur-xs';
      } else if (product.stock < 10) {
        span.textContent = 'Low stock';
        span.className = base + ' bg-amber-500/20 text-amber-200 border border-amber-400/20 backdrop-blur-xs';
      } else {
        span.textContent = 'In stock';
        span.className = base + ' bg-emerald-500/20 text-emerald-200 border border-emerald-400/20 backdrop-blur-xs';
      }
    }

    function render() {
      const list = getFilteredSorted();
      computeStats(list);
      const pageItems = paginate(list);
      els.grid.innerHTML = '';

      for (const p of pageItems) {
        const node = TPL.content.cloneNode(true);
        const article = node.querySelector('article');
        node.querySelector('img').src = p.image || 'https://images.unsplash.com/photo-1582719478250-71b68c7cb1bf?q=80&w=1200&auto=format&fit=crop';
        node.querySelector('[data-slot="sku"]').textContent = p.sku;
        node.querySelector('[data-slot="name"]').textContent = p.name;
        node.querySelector('[data-slot="category"]').textContent = p.category.replace('-', ' ');
        node.querySelector('[data-slot="price"]').textContent = currency(p.price);
        badge(node, p);

        // Actions
        node.querySelector('[data-action="edit"]').addEventListener('click', () => openModal(p));
        node.querySelector('[data-action="duplicate"]').addEventListener('click', () => duplicateProduct(p.id));
        node.querySelector('[data-action="delete"]').addEventListener('click', () => deleteProduct(p.id));
        node.querySelector('.toggle-active').checked = p.active;
        node.querySelector('.toggle-active').addEventListener('change', (e) => toggleActive(p.id, e.target.checked));

        if (state.dense) article.classList.add('p-2');

        els.grid.appendChild(node);
      }

      if (window.lucide) window.lucide.createIcons();
    }

    function openModal(product = null) {
      els.modal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      els.form.reset();
      els.productId.value = product?.id || '';
      els.modalTitle.textContent = product ? 'Edit product' : 'Add product';
      if (product) {
        els.name.value = product.name;
        els.sku.value = product.sku;
        els.category.value = product.category;
        els.price.value = product.price;
        els.stock.value = product.stock;
        els.image.value = product.image || '';
        els.description.value = product.description || '';
        els.active.checked = product.active;
      } else {
        els.active.checked = true;
      }
      setTimeout(() => els.name.focus(), 50);
    }

    function closeModal() {
      els.modal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }

    function saveProduct(e) {
      e.preventDefault();
      const data = {
        id: els.productId.value || crypto.randomUUID(),
        name: els.name.value.trim(),
        sku: els.sku.value.trim(),
        category: els.category.value,
        price: parseFloat(els.price.value),
        stock: parseInt(els.stock.value, 10),
        image: els.image.value.trim(),
        description: els.description.value.trim(),
        active: els.active.checked
      };
      const exists = state.products.find(p => p.id === data.id);
      if (exists) Object.assign(exists, data); else state.products.unshift(data);
      closeModal();
      render();
    }

    function deleteProduct(id) {
      if (!confirm('Delete this product?')) return;
      state.products = state.products.filter(p => p.id !== id);
      render();
    }

    function duplicateProduct(id) {
      const p = state.products.find(x => x.id === id);
      if (!p) return;
      const copy = { ...p, id: crypto.randomUUID(), sku: p.sku + '-COPY', name: p.name + ' (Copy)' };
      state.products.unshift(copy);
      render();
    }

    function toggleActive(id, value) {
      const p = state.products.find(x => x.id === id);
      if (!p) return;
      p.active = value;
      render();
    }

    function exportCSV() {
      const headers = ['ID','Name','SKU','Category','Price','Stock','Active'];
      const rows = state.products.map(p => [p.id, p.name, p.sku, p.category, p.price, p.stock, p.active]);
      const csv = [headers, ...rows].map(r => r.map(v => typeof v === 'string' && v.includes(',') ? `"${v}"` : v).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'products.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    // Events
    els.addBtn.addEventListener('click', () => openModal());
    els.closeModal.addEventListener('click', closeModal);
    els.modal.addEventListener('click', (e) => { if (e.target === els.modal.firstElementChild) closeModal(); });
    els.form.addEventListener('submit', saveProduct);
    els.resetForm.addEventListener('click', () => els.form.reset());
    els.prev.addEventListener('click', () => { state.page = Math.max(1, state.page - 1); render(); });
    els.next.addEventListener('click', () => { state.page = state.page + 1; render(); });
    els.search.addEventListener('input', () => { state.page = 1; render(); });
    els.filter.addEventListener('change', () => { state.page = 1; render(); });
    els.sort.addEventListener('change', () => { state.page = 1; render(); });
    els.exportCsv.addEventListener('click', exportCSV);
    els.themeToggle.addEventListener('click', () => {
      state.dense = !state.dense; document.documentElement.classList.toggle('text-[15px]'); render();
    });

    // Initialize
    render();
  </script>
</body>
</html>
