{% extends 'admin/base.html' %}
{% load static %}
{% load static dict_extras %}

{% block title %}Doctor Schedules - Curexa Admin{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/doctor_schedules.css' %}" />
{% endblock %}


{% block page_header %}
<!-- Breadcrumb above title -->
<div class="breadcrumb-above-title">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item"> <a href="{% url 'admin_dashboard' %}">Dashboard</a> </li>
      <li class="breadcrumb-item"> <a href="{% url 'doctor_list' %}" >Doctors </a> </li>
      <li class="breadcrumb-item active" aria-current="page">Schedules</li>
    </ol>
  </nav>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="page-title-section">
            <h2><i class="fas fa-calendar-alt me-2"></i>Doctor Schedules</h2>
            <p class="text-muted mb-0">Manage and view doctor appointments and availability</p>
        </div>
    </div>
</div>



<!-- Quick Stats Row -->
<div class="row mt-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card medical-border h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h5 class="card-title stats-number">{{todays_appointments}}</h5>
                        <p class="card-text stats-label">Today's Appointments</p>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-calendar-day card-icon text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card medical-border h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h5 class="card-title stats-number">{{doctor_on_duty}}</h5>
                        <p class="card-text stats-label">Doctors On Duty</p>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-user-md card-icon text-success"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card medical-border h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h5 class="card-title stats-number">{{available_time_slots}}</h5>
                        <p class="card-text stats-label">Available Time Slots</p>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-clock card-icon text-info"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card medical-border h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h5 class="card-title stats-number">{{emergency_cases}}</h5>
                        <p class="card-text stats-label">Emergency Cases</p>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-ambulance card-icon text-danger"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Controls Row -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="d-flex">
            <select class="form-select me-2" id="doctorFilter">
                <option value="all" selected>All Doctors</option>
                {% for doctor in doctors %}
                    <option value="{{ doctor.id }}">{{ doctor.doctor__first_name }} - {{ doctor.specialization__name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="col-md-4">
        <div class="d-flex">
            <input type="date" class="form-control me-2" id="datePicker" value="2024-01-21">
            <div class="btn-group">
                <button class="btn btn-outline-light" id="todayBtn">Today</button>
                <button class="btn btn-outline-light" id="nextDay">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="btn btn-outline-light" id="nextWeek">
                    Next Week <i class="fas fa-chevron-right ms-1"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="dropdown">
            <button class="btn btn-outline-light dropdown-toggle w-100" type="button" id="viewTypeDropdown" data-bs-toggle="dropdown">
                <i class="fas fa-eye me-1"></i> View Type
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item active" href="#" data-view="daily">Daily</a></li>
                <li><a class="dropdown-item" href="#" data-view="weekly">Weekly</a></li>
                <li><a class="dropdown-item" href="#" data-view="monthly">Monthly</a></li>
            </ul>
        </div>
    </div>
    <div class="col-md-3 text-end">
        <a href="#" class="btn btn-success" id="newScheduleBtn">
            <i class="fas fa-plus me-1"></i> New Schedule
        </a>
        <div class="btn-group ms-2">
            <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="fas fa-download"></i> Export
            </button>
            <!-- Import & Export Dropdown -->
            <ul class="dropdown-menu">
                <li><a class="dropdown-item export-btn" href="#" data-format="pdf"><i class="fas fa-file-pdf me-2"></i>PDF</a></li>
                <li><a class="dropdown-item export-btn" href="#" data-format="excel"><i class="fas fa-file-excel me-2"></i>Excel</a></li>
                <li><a class="dropdown-item export-btn" href="#" data-format="csv"><i class="fas fa-file-csv me-2"></i>CSV</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" id="importSchedule"><i class="fas fa-file-import me-2"></i>Import</a></li>
            </ul>
        </div>
        <button class="btn btn-outline-light ms-2" id="printSchedule">
            <i class="fas fa-print"></i>
        </button>
    </div>
</div>

<!-- Filters Row -->
<div class="row mb-3">
    <div class="col-12">
        <div class="card medical-border">
            <div class="card-body py-2">
                <div class="row g-2">
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" id="departmentFilter">
                            <option value="">All Departments</option>
                            {% for department in departments %}
                                <option value="{{ department.id }}">{{ department.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" id="appointmentTypeFilter">
                            <option value="">All Appointment Types</option>
                            {% for type in appointment_types %}
                                <option value="{{ type.value }}">{{ type.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" id="statusFilter">
                            <option value="">All Status</option>
                            {% for status in appointment_status %}
                                <option value="{{ status.value }}">{{ status.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control form-control-sm" id="searchPatient" placeholder="Search patient...">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card medical-border">
            <div class="card-body">
                <h4 class="mb-3" id="scheduleDate"></h4>
                <!-- Schedule View Tabs -->
                <ul class="nav nav-tabs" id="scheduleTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="daily-tab" data-bs-toggle="tab" data-bs-target="#daily" type="button" role="tab" aria-controls="daily" aria-selected="true">
                            <i class="fas fa-calendar-day me-1"></i> Daily View
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="weekly-tab" data-bs-toggle="tab" data-bs-target="#weekly" type="button" role="tab" aria-controls="weekly" aria-selected="false">
                            <i class="fas fa-calendar-week me-1"></i> Weekly View
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="doctors-tab" data-bs-toggle="tab" data-bs-target="#doctors" type="button" role="tab" aria-controls="doctors" aria-selected="false">
                            <i class="fas fa-user-md me-1"></i> By Doctor
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="grid-tab" data-bs-toggle="tab" data-bs-target="#grid" type="button" role="tab" aria-controls="grid" aria-selected="false">
                            <i class="fas fa-th me-1"></i> Grid View
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content mt-3" id="scheduleTabContent">
                    <!-- Daily View with Horizontal Scroll for Many Doctors -->
                    <div class="tab-pane fade show active" id="daily" role="tabpanel" aria-labelledby="daily-tab">
                        <div class="table-responsive">
                            <div class="doctor-scroll-container">
                                <table class="table table-hover" id="dailySchedule">
                                    <thead>
                                    <tr>
                                        <th class="time-column">Time</th>

                                        {% for doctor in doctors %}
                                            <th class="doctor-column">
                                                <div class="doctor-header">
                                                    {% if doctor.profile_picture %}
                                                        <img src="{{ doctor.profile_picture }}"
                                                            class="rounded-circle me-2" width="24" height="24">
                                                    {% else %}
                                                        <img src="{% static 'images/doctor_profiles/default-doctor.jpg' %}"
                                                            class="rounded-circle me-2" width="24" height="24">
                                                    {% endif %}

                                                    <div>
                                                        <div class="fw-bold">
                                                            Dr. {{ doctor.doctor__first_name }} {{ doctor.doctor__last_name }}
                                                        </div>
                                                        <small class="text-muted">
                                                            {{ doctor.specialization__name|default:"Department" }}
                                                        </small>
                                                    </div>
                                                </div>
                                            </th>
                                        {% endfor %}
                                    </tr>
                                    </thead>

                                    <tbody>
                                    {% for time in time_slots %}
                                        <tr>
                                            <!-- Time column -->
                                            <td class="fw-bold time-column">
                                                {{ time|time:"h:i A" }}
                                            </td>

                                            <!-- Doctor columns -->
                                            {% for doctor in doctors %}
                                                {% with appt=schedule_lookup|get_item:doctor.id|get_item:time %}
                                                    <td class="schedule-cell"
                                                        data-time="{{ time }}"
                                                        data-doctor="{{ doctor.id }}">

                                                        {% if appt %}
                                                            <div class="appointment booked">
                                                                <small class="d-block">{{ appt.patient_name }}</small>

                                                                <small class="badge badge-sm type-badge">
                                                                    {% for t in appointment_types %}
                                                                        {% if t.value == appt.appt_type %}
                                                                            {{ t.name }}
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </small>
                                                            </div>
                                                        {% else %}
                                                            <div class="appointment available">
                                                                <small>Available</small>
                                                            </div>
                                                        {% endif %}
                                                    </td>
                                                {% endwith %}
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-success me-2"><i class="fas fa-square"></i> Available</span>
                                <span class="badge bg-primary me-2"><i class="fas fa-square"></i> Booked</span>
                                <span class="badge bg-warning me-2"><i class="fas fa-square"></i> Break</span>
                                <span class="badge bg-danger me-2"><i class="fas fa-square"></i> Emergency</span>
                                <span class="badge bg-secondary me-2"><i class="fas fa-square"></i> Cancelled</span>
                                <span class="badge bg-info me-2"><i class="fas fa-square"></i> Follow-up</span>
                            </div>
                            <div class="text-muted">
                                Showing 6 doctors for Jan 21, 2024
                            </div>
                        </div>
                    </div>
                    
                    <!-- Weekly View -->
                    <div class="tab-pane fade" id="weekly" role="tabpanel" aria-labelledby="weekly-tab">
                        <div class="table-responsive">
                            <table class="table table-bordered table text-center">
                                <thead>
                                <tr>
                                    <th class="time-column">Time / Day</th>
                                    {% for day in week_days %}
                                        <th>
                                            <div>{{ day|date:"D" }}</div>
                                            <div class="small">{{ day|date:"M d" }}</div>
                                            {% if day == today %}
                                                <span class="badge bg-primary badge-sm">Today</span>
                                            {% endif %}
                                        </th>
                                    {% endfor %}
                                </tr>
                                </thead>
                                <tbody>
                                {% for t in all_times %}
                                <tr>
                                    <td class="fw-bold time-column">
                                        {{ t|time:"g:i A" }}
                                    </td>

                                    {% for day in week_days %}
                                        {% with cell=weekly_schedule|get_item:day|get_item:t %}
                                        <td class="weekly-cell"
                                            data-date="{{ day }}"
                                            data-time="{{ t|time:'H:i' }}">

                                            {% if cell.count > 0 %}
                                                <div class="weekly-appointment"
                                                    data-bs-toggle="tooltip"
                                                    title="{{ cell.count }} appointment(s)">
                                                    <span class="badge bg-primary">{{ cell.count }}</span>
                                                </div>
                                            {% else %}
                                                <span class="badge bg-success">Free</span>
                                            {% endif %}

                                        </td>
                                        {% endwith %}
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <h6>Weekly Summary</h6>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="card bg-light">
                                            <div class="card-body py-2">
                                                <small class="text-muted">Total Appointments</small>
                                                <h5 class="mb-0">187</h5>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="card bg-light">
                                            <div class="card-body py-2">
                                                <small class="text-muted">Available Slots</small>
                                                <h5 class="mb-0">42</h5>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 mt-2">
                                        <div class="card bg-light">
                                            <div class="card-body py-2">
                                                <small class="text-muted">Emergency Cases</small>
                                                <h5 class="mb-0 text-danger">8</h5>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 mt-2">
                                        <div class="card bg-light">
                                            <div class="card-body py-2">
                                                <small class="text-muted">Busiest Day</small>
                                                <h5 class="mb-0">Monday</h5>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6>Doctor Availability This Week</h6>
                                <div class="availability-chart">
                                    <div class="doctor-availability mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span>Dr. Sarah Johnson</span>
                                            <span class="badge bg-success">85%</span>
                                        </div>
                                        <div class="progress" style="height: 5px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 85%"></div>
                                        </div>
                                    </div>
                                    <div class="doctor-availability mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span>Dr. Michael Chen</span>
                                            <span class="badge bg-success">78%</span>
                                        </div>
                                        <div class="progress" style="height: 5px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 78%"></div>
                                        </div>
                                    </div>
                                    <div class="doctor-availability mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span>Dr. Anita Patel</span>
                                            <span class="badge bg-warning">65%</span>
                                        </div>
                                        <div class="progress" style="height: 5px;">
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 65%"></div>
                                        </div>
                                    </div>
                                    <div class="doctor-availability mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span>Dr. James Williams</span>
                                            <span class="badge bg-success">82%</span>
                                        </div>
                                        <div class="progress" style="height: 5px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 82%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- By Doctor View -->
                    <div class="tab-pane fade" id="doctors" role="tabpanel" aria-labelledby="doctors-tab">
                        <div class="row" id="doctorCardsContainer">
                            {% for item in doctors_today %}
                                <div class="col-lg-4 col-md-6 mb-4 doctor-card" data-department="{{ item.doctor.department.slug }}">
                                    <div class="card medical-border h-100">

                                        <!-- HEADER -->
                                        <div class="card-header">
                                            <div class="d-flex align-items-center">
                                                <img src="{{ item.doctor.avatar.url }}" alt="Dr. {{ item.doctor.full_name }}" class="rounded-circle me-2" width="40" height="40">
                                                <div>
                                                    <h5 class="card-title mb-0">Dr. {{ item.doctor.full_name }}</h5>
                                                    <small class="text-muted">{{ item.doctor.department.name }}</small>
                                                </div>
                                                <div class="ms-auto">
                                                    <span class="badge bg-{{ item.status.css }}">{{ item.status.label }}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- BODY -->
                                        <div class="card-body">
                                            <h6>Today's Schedule</h6>
                                            <div class="schedule-timeline">
                                                {% for slot in item.timeline %}
                                                    {% if slot.type == "break" %}
                                                        <div class="schedule-item break">
                                                            <span class="time">{{ slot.time|time:"g:i A" }}</span>
                                                            <span class="patient">{{ slot.label }}</span>
                                                        </div>
                                                    {% elif slot.type == "appointment" %}
                                                        <div class="schedule-item confirmed">
                                                            <span class="time">{{ slot.time|time:"g:i A" }}</span>
                                                            <span class="patient">{{ slot.patient }}</span>
                                                            <span class="badge badge-sm {{ slot.badge_class }}">{{ slot.badge }}</span>
                                                        </div>
                                                    {% else %}
                                                        <div class="schedule-item free">
                                                            <span class="time">{{ slot.time|time:"g:i A" }}</span>
                                                            <span class="patient">Available</span>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>

                                            <div class="mt-3 d-grid gap-2">
                                                <button class="btn btn-sm btn-outline-light schedule-btn" data-doctor="{{ item.doctor.id }}">
                                                    <i class="fas fa-calendar-plus me-1"></i> Schedule Appointment
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary view-schedule-btn" data-doctor="{{ item.doctor.id }}">
                                                    <i class="fas fa-calendar-alt me-1"></i> View Full Schedule
                                                </button>
                                            </div>
                                        </div>

                                        <!-- FOOTER -->
                                        <div class="card-footer bg-transparent">
                                            <small class="text-muted">
                                                <i class="fas fa-phone me-1"></i> {{ item.doctor.phone }} |
                                                <i class="fas fa-envelope me-1 ms-2"></i> {{ item.doctor.email|truncatechars:12 }}
                                            </small>
                                        </div>

                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Grid View -->
                    <div class="tab-pane fade" id="grid" role="tabpanel" aria-labelledby="grid-tab">
                        <div class="row g-3">
                            {% for item in doctors_today %}
                                <div class="col-xl-3 col-lg-4 col-md-6">
                                    <div class="card medical-border h-100">
                                        <div class="card-body text-center">
                                            <img src="{{ item.doctor.avatar.url }}" alt="Dr. {{ item.doctor.full_name }}" class="rounded-circle mb-3" width="80" height="80">
                                            <h5>Dr. {{ item.doctor.full_name }}</h5>
                                            <p class="text-muted">{{ item.doctor.department.name }}</p>

                                            <div class="doctor-stats mb-3">
                                                <div class="row text-center">
                                                    <div class="col-4">
                                                        <div class="stat-number">
                                                            {{ item.timeline|length }} <!-- Number of slots today -->
                                                        </div>
                                                        <small class="text-muted">Today</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="stat-number">
                                                            {% with count=0 %}
                                                            {% for t in item.timeline %}
                                                                {% if t.type == "appointment" %}
                                                                    {% widthratio count|add:1 1 1 %}<!-- Increment counter -->
                                                                {% endif %}
                                                            {% endfor %}
                                                            {{ count }}
                                                            {% endwith %}
                                                        </div>
                                                        <small class="text-muted">This Week</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="stat-number">
                                                            {% if item.status.label == "Available" %}100{% else %}{{ item.timeline|length|divisibleby:2|yesno:"50,0" }}{% endif %}%
                                                        </div>
                                                        <small class="text-muted">Available</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="d-grid gap-2">
                                                <button class="btn btn-sm btn-success schedule-btn" data-doctor="{{ item.doctor.id }}">
                                                    <i class="fas fa-calendar-plus me-1"></i> Book Now
                                                </button>
                                                <button class="btn btn-sm btn-outline-light view-schedule-btn" data-doctor="{{ item.doctor.id }}">
                                                    View Schedule
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Appointment Detail Modal -->
<div class="modal fade" id="appointmentDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Appointment Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="appointmentDetailContent">
                <!-- Content loaded via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editAppointmentBtn">Edit</button>
                <button type="button" class="btn btn-danger" id="cancelAppointmentBtn">Cancel</button>
                <button type="button" class="btn btn-success" id="completeAppointmentBtn">Mark Complete</button>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Import Schedules</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="importForm">
                    <div class="mb-3">
                        <label for="importFile" class="form-label">Select File</label>
                        <input type="file" class="form-control" id="importFile" accept=".csv,.xlsx,.xls">
                        <div class="form-text">Supported formats: CSV, Excel (.xlsx, .xls)</div>
                    </div>
                    <div class="mb-3">
                        <label for="importType" class="form-label">Import Type</label>
                        <select class="form-select" id="importType">
                            <option value="appointments">Appointments Only</option>
                            <option value="schedules">Doctor Schedules</option>
                            <option value="both">Both Appointments & Schedules</option>
                        </select>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="overwriteExisting">
                        <label class="form-check-label" for="overwriteExisting">
                            Overwrite existing appointments on conflict
                        </label>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Download the <a href="#" id="downloadTemplate">template file</a> for proper formatting
                    </div>
                </form>
                <!-- Preview injected here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="startImport" disabled>Import</button>
            </div>
        </div>
    </div>
</div>



<script>
  const scheduleDate = document.getElementById("scheduleDate");

  const today = new Date();
  const options = {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric"
  };

  scheduleDate.textContent = today.toLocaleDateString("en-US", options);
</script>

<script>



</script>



{% endblock %}