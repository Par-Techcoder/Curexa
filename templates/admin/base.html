{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Curexa Healthcare Admin{% endblock %}</title>

    <link
      rel="icon"
      href="{% static 'images/favicon.ico' %}"
      type="image/x-icon"
    />

    <!-- Bootstrap & Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

    <!-- Toast Message Implementation-->
    <script>
      window.djangoMessages = [
        {% for message in messages %}
          {
            "tags": "{{ message.tags }}",
            "message": "{{ message|escapejs }}"
          }{% if not forloop.last %},{% endif %}
        {% endfor %}
      ];
    </script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.all.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.min.css"
    />

    <!-- Include external toast script -->
    <script src="{% static 'js/toast_message.js' %}"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Theme toggle functionality
        if (localStorage.getItem("theme") === "dark") {
          document.body.classList.add("dark-theme");
          document
            .getElementById("themeIcon")
            .classList.replace("bi-moon", "bi-sun");
        }

        const themeToggle = document.getElementById("themeToggle");
        const themeIcon = document.getElementById("themeIcon");

        if (themeToggle) {
          themeToggle.addEventListener("click", function () {
            document.body.classList.toggle("dark-theme");

            if (document.body.classList.contains("dark-theme")) {
              themeIcon.classList.replace("bi-moon", "bi-sun");
              localStorage.setItem("theme", "dark");
            } else {
              themeIcon.classList.replace("bi-sun", "bi-moon");
              localStorage.setItem("theme", "light");
            }
          });
        }

        // Auto-update time in navbar
        updateDateTime();
        setInterval(updateDateTime, 60000);
      });

      function updateDateTime() {
        const now = new Date();
        const dateTimeElement = document.getElementById("currentDateTime");
        if (dateTimeElement) {
          const options = {
            weekday: "short",
            year: "numeric",
            month: "short",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          };
          dateTimeElement.textContent = now.toLocaleDateString(
            "en-US",
            options
          );
        }
      }
    </script>

    <style>
      :root {
        --medical-blue: #1a5f7a;
        --medical-teal: #2d8c8c;
        --medical-green: #57cc99;
        --medical-light-blue: #c7f9cc;
        --medical-dark: #0a1931;
        --medical-light: #f8f9fa;
        --medical-alert: #ff6b6b;
        --medical-warning: #ffd93d;
        --medical-purple: #6a67ce;
        --medical-gray: #6c757d;
      }

      body {
        background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
        color: #333;
        font-family: "Segoe UI", "Roboto", "Open Sans", sans-serif;
        min-height: 100vh;
        padding-top: 30px;
      }

      .dark-theme {
        background-color: #343a40 !important;
        color: #f8f9fa !important;
      }
      .dark-theme a {
        color: #f8f9fa !important;
      }
      .dark-theme .navbar {
        background-color: #212529 !important;
      }
      .dark-theme #sidebar {
        background-color: #212529;
        color: #f8f9fa;
      }
      .dark-theme .list-group-item {
        background-color: #343a40;
        border-color: #495057;
        color: #f8f9fa;
      }
      .dark-theme .list-group-item:hover,
      .dark-theme .list-group-item.active {
        background-color: #495057;
        color: #fff;
      }
      .dark-theme .submenu {
        background-color: #343a40;
        color: #f8f9fa;
      }
      .dark-theme .submenu-header {
        color: #f8f9fa;
      }
      .dark-theme .center-bodycontent {
        background-color: #343a40;
        color: #f8f9fa;
      }

      .navbar {
        z-index: 1030;
        background: linear-gradient(
          135deg,
          var(--medical-blue),
          var(--medical-teal)
        ) !important;
        border-bottom: 3px solid var(--medical-green);
        box-shadow: 0 2px 15px rgba(26, 95, 122, 0.2);
      }

      .navbar-brand {
        font-weight: 700;
        letter-spacing: 0.5px;
        font-size: 1.2rem;
      }

      /* Page Title Section with Dot Pattern */
      .page-title-section {
        background: linear-gradient(
          135deg,
          var(--medical-blue),
          var(--medical-teal)
        );
        padding: 25px 30px;
        margin: -20px -20px 30px -20px;
        border-radius: 0 0 15px 15px;
        box-shadow: 0 4px 20px rgba(26, 95, 122, 0.15);
        position: relative;
        overflow: hidden;
      }

      .page-title-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
      }

      .page-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: white;
        margin: 0;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
      }

      .page-title i {
        margin-right: 10px;
        background: rgba(255, 255, 255, 0.2);
        padding: 8px;
        border-radius: 8px;
      }

      .page-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        margin-top: 5px;
        position: relative;
        z-index: 1;
      }
      /* Add this to your base.html CSS, after the existing .page-title-section styles */

      /* Breadcrumb above title section */
      .breadcrumb-above-title {
        margin: -20px -20px 15px -20px;
        padding: 15px 30px;
        background: rgba(26, 95, 122, 0.9);
        border-radius: 15px 15px 0 0;
        position: relative;
        z-index: 5;
      }

      .breadcrumb-above-title .breadcrumb {
        margin-bottom: 0;
        padding: 0;
        background: transparent;
      }

      .breadcrumb-above-title .breadcrumb-item a {
        color: rgba(255, 255, 255, 0.9) !important;
        text-decoration: none;
      }

      .breadcrumb-above-title .breadcrumb-item.active {
        color: white !important;
        font-weight: 500;
      }

      .breadcrumb-above-title .breadcrumb-item + .breadcrumb-item::before {
        color: rgba(255, 255, 255, 0.5);
      }

      /* Adjust page-title-section to sit below breadcrumb */
      .page-title-section {
        margin-top: -15px; /* Pull up to connect with breadcrumb */
        border-radius: 0 0 15px 15px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .breadcrumb-above-title {
          margin: -20px -15px 15px -15px;
          padding: 15px 20px;
          border-radius: 0;
        }

        .page-title-section {
          margin-top: -15px;
          border-radius: 0;
        }
      }

      /* Sidebar Implementation like Quick-come */
      #sidebar {
        position: fixed;
        top: 56px;
        left: 0;
        height: calc(100vh - 56px);
        background-color: #fff;
        border-right: 1px solid #ddd;
        transition: width 0.3s ease;
        overflow: visible;
        width: 60px;
        z-index: 1020;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }

      #sidebar.expanded {
        width: 250px;
      }

      /* Profile Section */
      .profile-section {
        padding: 1rem;
        border-bottom: 1px solid #ddd;
        background-color: #f8f9fa;
        display: flex;
        align-items: center;
      }

      .profile-section img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 50%;
      }

      #sidebar .profile-text {
        opacity: 0;
        transition: opacity 0.3s ease;
        margin-left: 10px;
        white-space: nowrap;
      }

      #sidebar.expanded .profile-text {
        opacity: 1;
      }

      /* Menu Items */
      #sidebar .list-group-item {
        border: none;
        height: 50px;
        padding: 0.75rem 1rem;
        cursor: pointer;
        position: relative;
        transition: background-color 0.3s ease;
        color: #333;
      }

      #sidebar .list-group-item:hover {
        background-color: #e9ecef;
      }

      #sidebar .list-group-item.active {
        background: linear-gradient(90deg, var(--medical-blue), transparent);
        color: white;
        border-left: 3px solid var(--medical-green);
      }

      .sidebar-icon {
        display: inline-block;
        width: 30px;
        text-align: center;
        font-size: 1.1rem;
      }

      .sidebar-text {
        opacity: 0;
        transition: opacity 0.3s ease;
        margin-left: 10px;
        white-space: nowrap;
        font-size: 0.95rem;
      }

      #sidebar.expanded .sidebar-text {
        opacity: 1;
      }

      /* Dropdown caret: hidden in collapsed mode, visible in expanded mode */
      #sidebar:not(.expanded) .sidebar-caret {
        display: none;
      }

      #sidebar.expanded .sidebar-caret {
        display: inline-block;
        margin-left: auto;
        transition: transform 0.3s ease;
      }

      #sidebar.expanded .sidebar-dropdown.open .sidebar-caret {
        transform: rotate(180deg);
      }

      /* Force parent items in expanded mode to use flex layout */
      #sidebar.expanded .list-group-item.parent-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      /* Sidebar Dropdown container */
      .sidebar-dropdown {
        position: relative;
      }

      /* Highlight effect for parent items in collapsed mode */
      #sidebar:not(.expanded) .sidebar-dropdown:hover > .list-group-item {
        background-color: #e0e0e0;
        border-right: 4px solid var(--medical-blue);
      }

      /* Custom submenu styles */
      .submenu {
        display: none;
      }

      /* In collapsed mode: show submenu on hover attached to the parent container */
      #sidebar:not(.expanded) .sidebar-dropdown:hover .submenu {
        display: block !important;
        position: absolute;
        top: 0;
        left: 60px;
        width: 200px;
        background-color: #fff;
        border: 1px solid #ddd;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 1100;
        border-radius: 0 5px 5px 0;
        overflow: hidden;
      }

      /* Expanded mode: animate submenu open/close */
      #sidebar.expanded .sidebar-dropdown .submenu {
        display: block;
        position: static;
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        background: rgba(26, 95, 122, 0.05);
        border-left: 2px solid var(--medical-teal);
        margin-left: 10px;
      }

      #sidebar.expanded .sidebar-dropdown.open .submenu {
        max-height: 300px;
        opacity: 1;
      }

      /* Add header and divider for submenu pop-up in collapsed mode */
      .submenu-header {
        font-weight: bold;
        padding: 0.75rem 1rem;
        background: linear-gradient(
          90deg,
          var(--medical-blue),
          var(--medical-teal)
        );
        color: white;
        font-size: 0.9rem;
      }

      .submenu-divider {
        margin: 0;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      /* Hide submenu header and divider in expanded mode */
      #sidebar.expanded .submenu .submenu-header,
      #sidebar.expanded .submenu .submenu-divider {
        display: none;
      }

      /* Style submenu links */
      .submenu a {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        color: #333;
        text-decoration: none;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
      }

      .submenu a:hover {
        background-color: #f1f1f1;
        border-left: 3px solid var(--medical-green);
        padding-left: 1.25rem;
      }

      .submenu a i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
      }

      /* Dashboard hover tooltip effect in collapsed mode */
      #sidebar:not(.expanded) .dashboard:hover::after {
        content: attr(data-title);
        position: absolute;
        left: 60px;
        top: 50%;
        transform: translateY(-50%);
        background-color: var(--medical-dark);
        border: 1px solid #ddd;
        padding: 0.75rem 1rem;
        min-width: 120px;
        z-index: 1100;
        white-space: nowrap;
        font-size: 14px;
        color: white;
        border-radius: 0 5px 5px 0;
      }

      /* Main Content Area */
      .center-bodycontent {
        margin-top: 56px;
        margin-left: 60px;
        transition: margin-left 0.3s ease;
        padding: 20px;
        min-height: calc(100vh - 56px);
        background: #f8fafc;
      }

      .center-bodycontent.expanded {
        margin-left: 250px;
      }

      .list-group-item:first-child {
        border-top-left-radius: 0 !important;
        border-top-right-radius: 0 !important;
      }

      /* Medical badges and status indicators */
      .notification-badge {
        position: absolute;
        top: 5px;
        right: 5px;
        background: var(--medical-alert);
        color: white;
        border-radius: 50%;
        min-width: 20px;
        height: 20px;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
      }

      .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-indicator.active {
        background: var(--medical-green);
      }

      .status-indicator.pending {
        background: var(--medical-warning);
      }

      .status-indicator.emergency {
        background: var(--medical-alert);
      }

      /* Medical Form Elements */
      .medical-form-control {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 10px 15px;
        transition: all 0.3s;
      }

      .medical-form-control:focus {
        border-color: var(--medical-teal);
        box-shadow: 0 0 0 0.25rem rgba(26, 95, 122, 0.1);
      }

      .btn-medical-primary {
        background: linear-gradient(
          135deg,
          var(--medical-blue),
          var(--medical-teal)
        );
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        padding: 10px 25px;
        transition: all 0.3s;
      }

      .btn-medical-primary:hover {
        background: linear-gradient(
          135deg,
          var(--medical-teal),
          var(--medical-blue)
        );
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(26, 95, 122, 0.3);
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        body {
          padding-top: 66px;
        }

        #sidebar {
          width: 0;
          transform: translateX(-100%);
        }

        #sidebar.expanded {
          width: 250px;
          transform: translateX(0);
        }

        .center-bodycontent {
          margin-left: 0;
        }

        .center-bodycontent.expanded {
          margin-left: 0;
        }

        #sidebar:not(.expanded) .dashboard:hover::after {
          display: none;
        }

        .page-title-section {
          margin: -20px -15px 25px -15px;
          border-radius: 0;
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container-fluid">
        <button class="btn btn-outline-light me-2" id="sidebarToggle">
          <i class="fas fa-bars"></i>
        </button>

        {% block navbar_extra %}{% endblock %}

        <span class="navbar-brand fw-bold text-white">
          <i class="fas fa-heartbeat me-2"></i>Curexa Healthcare Admin
          <small
            class="d-none d-md-inline ms-2"
            style="font-size: 0.8rem; opacity: 0.9"
            >Comprehensive Healthcare Management</small
          >
        </span>

        <div class="d-flex align-items-center ms-auto">
          <!-- Current Date/Time -->
          <div class="text-white me-3 d-none d-md-block">
            <i class="fas fa-clock me-1"></i>
            <span id="currentDateTime" style="font-size: 0.85rem"></span>
          </div>

          <!-- Notifications -->
          <div class="dropdown me-3">
            <button
              class="btn btn-outline-light position-relative"
              type="button"
              id="notificationDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="fas fa-bell"></i>
              <span class="notification-badge">5</span>
            </button>
            <ul
              class="dropdown-menu dropdown-menu-end p-0"
              style="min-width: 350px"
              aria-labelledby="notificationDropdown"
            >
              <li class="dropdown-header bg-light py-3">
                <div class="d-flex justify-content-between align-items-center">
                  <h6 class="mb-0">
                    <i class="fas fa-bell me-2 text-primary"></i>Medical Alerts
                  </h6>
                  <span class="badge bg-primary">5 New</span>
                </div>
              </li>
              <li>
                <div class="list-group list-group-flush">
                  <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex align-items-start">
                      <div class="me-3">
                        <span class="status-indicator emergency"></span>
                      </div>
                      <div class="flex-grow-1">
                        <div class="fw-bold">Critical Patient Alert</div>
                        <small class="text-danger">Room 204 - BP 180/110</small>
                        <div class="text-muted small mt-1">2 minutes ago</div>
                      </div>
                    </div>
                  </a>
                  <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex align-items-start">
                      <div class="me-3">
                        <span class="status-indicator warning"></span>
                      </div>
                      <div class="flex-grow-1">
                        <div class="fw-bold">Low Stock Warning</div>
                        <small class="text-warning"
                          >Amoxicillin - 15 units left</small
                        >
                        <div class="text-muted small mt-1">1 hour ago</div>
                      </div>
                    </div>
                  </a>
                </div>
              </li>
              <li class="dropdown-footer text-center py-2">
                <a href="#" class="text-decoration-none small">
                  <i class="fas fa-list me-1"></i> View All Alerts
                </a>
              </li>
            </ul>
          </div>

          <!-- User Profile & Theme Toggle -->
          <div class="dropdown">
            <button
              class="btn btn-outline-light dropdown-toggle d-flex align-items-center"
              type="button"
              id="userDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="fas fa-user-md me-2"></i>
              <span class="d-none d-md-inline">{{ user.first_name }}</span>
            </button>
            <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="userDropdown"
            >
              <li class="dropdown-header">
                <div class="d-flex align-items-center">
                  <img
                    src="{% if user.profile_picture %}{{ user.profile_picture }}{% else %}{% static 'images/default_pic.jpg' %}{% endif %}"
                    alt="Profile"
                    class="rounded-circle me-2"
                    width="40"
                    height="40"
                  />
                  <div>
                    <strong>{{ user.first_name }}</strong>
                    <div class="small text-muted">Healthcare Administrator</div>
                  </div>
                </div>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <button id="themeToggle" class="dropdown-item">
                  <i id="themeIcon" class="bi bi-moon me-2"></i>Toggle Theme
                </button>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                  ><i class="fas fa-user-circle me-2"></i>My Profile</a
                >
              </li>
              <li>
                <a class="dropdown-item" href="#"
                  ><i class="fas fa-cog me-2"></i>Account Settings</a
                >
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a
                  class="dropdown-item text-danger"
                  href="{% url 'admin_logout' %}"
                  ><i class="fas fa-sign-out-alt me-2"></i>Logout</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <!-- Sidebar -->
    <div id="sidebar">
      <!-- Profile -->
      <div class="profile-section">
        <img
          src="{% if user.profile_picture %}{{ user.profile_picture }}{% else %}{% static 'images/default_pic.jpg' %}{% endif %}"
          alt="Profile"
        />
        <div class="profile-text">
          <strong>{{ user.first_name }}</strong>
          <small>{{ user.email }}</small>
        </div>
      </div>

      <!-- Menu -->
      <div class="list-group">
        <!-- Dashboard with hover tooltip -->
        <a
          href="{% url 'admin_dashboard' %}"
          class="list-group-item dashboard"
          data-title="Dashboard"
        >
          <i class="fas fa-tachometer-alt sidebar-icon"></i>
          <span class="sidebar-text">Medical Dashboard</span>
        </a>

        <!-- Medical Staff with submenu -->
        <div class="sidebar-dropdown">
          <a href="{% url 'doctor_list' %}" class="list-group-item parent-item">
            <i class="fas fa-user-md sidebar-icon"></i>
            <span class="sidebar-text">Medical Staff</span>
            <i class="bi bi-chevron-down sidebar-caret"></i>
          </a>
          <div class="submenu">
            <div class="submenu-header">Medical Staff</div>
            <hr class="submenu-divider" />
            <a href="{% url 'doctor_list' %}"
              ><i class="fas fa-list me-2"></i>All Doctors</a
            >
            <a href="{% url 'doctor_add' %}"
              ><i class="fas fa-plus-circle me-2"></i>Add Doctor</a
            >
            <a href="{% url 'doctor_schedles' 1 %}"
              ><i class="fas fa-calendar-check me-2"></i>Schedules</a
            >
          </div>
        </div>

        <!-- Pharmacy with submenu -->
        <div class="sidebar-dropdown">
          <a
            href="{% url 'medicine_list' %}"
            class="list-group-item parent-item"
          >
            <i class="fas fa-pills sidebar-icon"></i>
            <span class="sidebar-text">Pharmacy</span>
            <i class="bi bi-chevron-down sidebar-caret"></i>
          </a>
          <div class="submenu">
            <div class="submenu-header">Pharmacy</div>
            <hr class="submenu-divider" />
            <a href="{% url 'medicine_list' %}"
              ><i class="fas fa-capsules me-2"></i>Medicine List</a
            >
            <a href="{% url 'inventory_list' %}"
              ><i class="fas fa-cube me-2"></i>Inventory</a
            >
            <a href="{% url 'category_list' %}"
              ><i class="fas fa-tags me-2"></i>Categories</a
            >
          </div>
        </div>

        <!-- Patients with submenu -->
        <div class="sidebar-dropdown">
          <a
            href="{% url 'patient_list' %}"
            class="list-group-item parent-item"
          >
            <i class="fas fa-procedures sidebar-icon"></i>
            <span class="sidebar-text">Patients</span>
            <i class="bi bi-chevron-down sidebar-caret"></i>
          </a>
          <div class="submenu">
            <div class="submenu-header">Patients</div>
            <hr class="submenu-divider" />
            <a href="{% url 'patient_list' %}"
              ><i class="fas fa-users me-2"></i>All Patients</a
            >
            <a href="{% url 'patient_add' %}"
              ><i class="fas fa-user-plus me-2"></i>Add Patient</a
            >
            <a href="{% url 'patient_medical_records' 8 %}"
              ><i class="fas fa-file-medical me-2"></i>Medical Records</a
            >
          </div>
        </div>

        <!-- Appointments with submenu -->
        <div class="sidebar-dropdown">
          <a
            href="{% url 'appointment_list' %}"
            class="list-group-item parent-item"
          >
            <i class="fas fa-calendar-alt sidebar-icon"></i>
            <span class="sidebar-text">Appointments</span>
            <i class="bi bi-chevron-down sidebar-caret"></i>
          </a>
          <div class="submenu">
            <div class="submenu-header">Appointments</div>
            <hr class="submenu-divider" />
            <a href="{% url 'appointment_list' %}"
              ><i class="fas fa-calendar-day me-2"></i>Today's Schedule</a
            >
            <a href="{% url 'appointment_add' %}"
              ><i class="fas fa-plus-circle me-2"></i>Book Appointment</a
            >
            <a href="{% url 'appointment_history' %}"
              ><i class="fas fa-history me-2"></i>Appointment History</a
            >
          </div>
        </div>

        <!-- Reports with submenu -->
        <div class="sidebar-dropdown">
          <a
            href="{% url 'sales_reports' %}"
            class="list-group-item parent-item"
          >
            <i class="fas fa-chart-line sidebar-icon"></i>
            <span class="sidebar-text">Reports</span>
            <i class="bi bi-chevron-down sidebar-caret"></i>
          </a>
          <div class="submenu">
            <div class="submenu-header">Reports</div>
            <hr class="submenu-divider" />
            <a href="{% url 'sales_reports' %}"
              ><i class="fas fa-file-invoice-dollar me-2"></i>Financial
              Reports</a
            >
            <a href="{% url 'inventory_reports' %}"
              ><i class="fas fa-pills me-2"></i>Pharmacy Reports</a
            >
            <a href="{% url 'appoinment_reports' %}"
              ><i class="fas fa-user-md me-2"></i>Clinical Reports</a
            >
          </div>
        </div>

        <!-- Settings -->
        <a href="#" class="list-group-item">
          <i class="fas fa-cogs sidebar-icon"></i>
          <span class="sidebar-text">System Settings</span>
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="center-bodycontent" id="mainContent">
      <main class="container-fluid">
        {% block page_header %}
        <!-- [page-specific page header goes here -->
        {% endblock %} {% block content %}
        <!-- Page-specific content goes here -->
        {% endblock %}
      </main>
    </div>

    <script>
      // Toggle sidebar expanded/collapsed state
      const sidebarToggle = document.getElementById("sidebarToggle");
      const sidebar = document.getElementById("sidebar");
      const mainContent = document.getElementById("mainContent");

      sidebarToggle.addEventListener("click", function () {
        sidebar.classList.toggle("expanded");
        mainContent.classList.toggle("expanded");
      });

      // In expanded mode, toggle submenu on click of parent item and close others
      document
        .querySelectorAll("#sidebar .sidebar-dropdown .parent-item")
        .forEach((item) => {
          item.addEventListener("click", function (e) {
            if (sidebar.classList.contains("expanded")) {
              e.preventDefault();
              const currentDropdown = this.closest(".sidebar-dropdown");
              // Close any other open submenus
              document
                .querySelectorAll("#sidebar .sidebar-dropdown.open")
                .forEach((dropdown) => {
                  if (dropdown !== currentDropdown) {
                    dropdown.classList.remove("open");
                  }
                });
              currentDropdown.classList.toggle("open");
            }
          });
        });

      // Auto-close sidebar on mobile when clicking outside
      document.addEventListener("click", function (event) {
        if (window.innerWidth < 768 && sidebar.classList.contains("expanded")) {
          if (
            !sidebar.contains(event.target) &&
            event.target !== sidebarToggle &&
            !sidebarToggle.contains(event.target)
          ) {
            sidebar.classList.remove("expanded");
            mainContent.classList.remove("expanded");
          }
        }
      });

      // Highlight current page in sidebar
      document.addEventListener("DOMContentLoaded", function () {
        const currentPath = window.location.pathname;

        // Remove active class from all menu items
        document
          .querySelectorAll("#sidebar .list-group-item")
          .forEach((item) => {
            item.classList.remove("active");
          });

        // Find and activate current page
        document.querySelectorAll("#sidebar a[href]").forEach((link) => {
          if (link.getAttribute("href") === currentPath) {
            link.classList.add("active");

            // Also activate parent dropdown if it exists
            const parentDropdown = link.closest(".sidebar-dropdown");
            if (parentDropdown) {
              parentDropdown.classList.add("open");
            }
          }
        });
      });
    </script>
  </body>
</html>
