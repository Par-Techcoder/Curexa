{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Curexa Admin Portal - Login</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(to bottom right, #0f172a, #1e293b, #111827);
      color: #f9fafb;
    }

    .glass-card {
      background: rgba(17, 24, 39, 0.85);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    }

    .btn-primary {
      background-color: #2563eb;
      color: #fff;
      font-weight: 500;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease-in-out;
      border: none;
      cursor: pointer;
      width: 100%;
    }
    .btn-primary:hover { background-color: #1e40af; }
    .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; }

    input[type="email"], input[type="password"] {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #374151;
      border-radius: 0.5rem;
      background: #111827;
      color: #f9fafb;
      transition: 0.2s;
    }
    input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px #2563eb;
      outline: none;
    }

    label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #d1d5db;
    }

    .error-message {
      padding: 0.75rem;
      background: #7f1d1d;
      border: 1px solid #f87171;
      color: #fca5a5;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      margin-top: 0.75rem;
    }

    .logo-box {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 4rem;
      height: 4rem;
      background: #1e40af;
      border-radius: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    footer {
      margin-top: 1.5rem;
      text-align: center;
      font-size: 0.75rem;
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <!-- Background Security Grid -->
  <div style="position:fixed; inset:0; opacity:0.07; z-index:-10;
              background:url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22 viewBox=%220 0 40 40%22%3E%3Cg fill=%22%23ffffff%22 fill-opacity=%220.1%22%3E%3Crect width=%2240%22 height=%220.5%22/%3E%3Crect width=%220.5%22 height=%2240%22/%3E%3C/g%3E%3C/svg%3E') repeat;">
  </div>

  <!-- Main Container -->
  <main style="width:100%; max-width:28rem; padding:2rem;">
    <!-- Logo Section -->
    <div class="text-center">
      <div class="logo-box" style="background:transparent; box-shadow:none; margin-bottom:1rem;">
        <img src="{% static 'images/curexa_logo_transparent.png' %}" 
            alt="Curexa Logo" 
            style="width: 8rem; height: auto;" />
      </div>
      <h1 class="text-2xl" style="font-weight:600; margin-bottom:0.5rem;">Curexa Admin Portal</h1>
      <p class="text-sm" style="color:#9ca3af;">Restricted Access — Authorized Personnel Only</p>
    </div>

    <!-- Login Form Card -->
    <section class="glass-card">
      <header style="margin-bottom:1.5rem;">
        <h2 style="font-size:1.25rem; font-weight:600; margin-bottom:0.5rem;">Admin Login</h2>
        <p style="font-size:0.875rem; color:#9ca3af;">Enter your credentials to continue</p>
      </header>

      <!-- Login Form -->
      <form id="loginForm" method="post" novalidate>
        {% csrf_token %}
        {% if error_message %}
          <div class="error-message">{{ error_message }}</div>
        {% endif %}
        <!-- Email -->
        <div style="margin-bottom:1rem;">
          <label for="email">Admin Email</label>
          <input type="email" id="email" name="email" placeholder="admin@curexa.com" required />
        </div>

        <!-- Password -->
        <div style="margin-bottom:1rem;">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" placeholder="••••••••" required />
        </div>

        <!-- Button -->
        <button type="submit" id="signInBtn" class="btn-primary">
          <span id="btnText">Sign In</span>
          <svg id="loadingIcon" style="margin-left:0.5rem; height:1rem; width:1rem; display:none;" class="animate-spin" fill="none" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" style="opacity:0.25"/>
            <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 
                     0 0 5.373 0 12h4zm2 
                     5.291A7.962 7.962 0 014 12H0c0 
                     3.042 1.135 5.824 3 
                     7.938l3-2.647z" style="opacity:0.75"/>
          </svg>
        </button>

        <!-- Error -->
        <div id="errorMessage" class="error-message" style="display:none;">
          Invalid email or password. Unauthorized access attempt logged.
        </div>
      </form>
    </section>

    <!-- Footer -->
    <footer>
      © 2025 Curexa Admin. Unauthorized access is prohibited. All login attempts are monitored.
    </footer>
  </main>

  <script>
loginForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();

    signInBtn.disabled = true;
    btnText.textContent = 'Signing In...';
    loadingIcon.style.display = 'inline-block';
    errorMessage.style.display = 'none';

    // Get CSRF token from the cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    // Send POST to Django
    const response = await fetch("{% url 'admin_login' %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': csrftoken
        },
        body: `email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
    });

    if (response.redirected) {
        window.location.href = response.url;  // login success
    } else {
        signInBtn.disabled = false;
        btnText.textContent = 'Sign In';
        loadingIcon.style.display = 'none';
        errorMessage.style.display = 'block';
    }
});


  </script>
</body>
</html>
